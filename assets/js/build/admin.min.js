/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./assets/js/src/admin/index.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./assets/js/src/admin/index.js":
/*!**************************************!*\
  !*** ./assets/js/src/admin/index.js ***!
  \**************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _modules_book_layout_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./modules/book-layout.js */ "./assets/js/src/admin/modules/book-layout.js");
/* harmony import */ var _modules_book_index_title__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./modules/book-index-title */ "./assets/js/src/admin/modules/book-index-title.js");
/* harmony import */ var _modules_categories__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./modules/categories */ "./assets/js/src/admin/modules/categories.js");
/* harmony import */ var _modules_media_upload__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./modules/media-upload */ "./assets/js/src/admin/modules/media-upload.js");
/* harmony import */ var _modules_tags__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./modules/tags */ "./assets/js/src/admin/modules/tags.js");
/* harmony import */ var _modules_taxonomies_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./modules/taxonomies.js */ "./assets/js/src/admin/modules/taxonomies.js");
/**
 * Admin Scripts
 *
 * @package book-database
 * @copyright Copyright (c) 2019, Ashley Gibson
 * @license GPL2+
 */







(function ($) {
  _modules_book_layout_js__WEBPACK_IMPORTED_MODULE_0__["BDB_Book_Layout"].init();
  _modules_book_index_title__WEBPACK_IMPORTED_MODULE_1__["BDB_Book_Index_Title"].init();
  _modules_categories__WEBPACK_IMPORTED_MODULE_2__["BDB_Categories"].init();
  _modules_media_upload__WEBPACK_IMPORTED_MODULE_3__["BDB_Media"].init();
  _modules_tags__WEBPACK_IMPORTED_MODULE_4__["BDB_Tags"].init();
  _modules_taxonomies_js__WEBPACK_IMPORTED_MODULE_5__["BDB_Book_Taxonomies"].init();
})(jQuery);

/***/ }),

/***/ "./assets/js/src/admin/modules/book-index-title.js":
/*!*********************************************************!*\
  !*** ./assets/js/src/admin/modules/book-index-title.js ***!
  \*********************************************************/
/*! exports provided: BDB_Book_Index_Title */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* WEBPACK VAR INJECTION */(function($) {/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "BDB_Book_Index_Title", function() { return BDB_Book_Index_Title; });
/* harmony import */ var utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! utils */ "./assets/js/src/utils/index.js");
/* global $, bdbVars, wp */

var BDB_Book_Index_Title = {
  bookTitleField: false,
  indexTitleSelect: false,
  indexTitleCustomField: false,

  /**
   * Initialize
   */
  init: function init() {
    this.bookTitleField = $('#bdb-book-title');
    this.indexTitleSelect = $('#bdb-book-index-title');
    this.indexTitleCustomField = $('#bdb-book-index-title-custom');
    this.indexTitleSelect.on('change', this.toggleCustomIndexTitle).trigger('change');
    this.bookTitleField.on('keyup', this.writeOriginalTitle);
    this.bookTitleField.on('blur', this.populateIndexTitles);
  },

  /**
   * Show the "Custom" box if "Custom" is selected. Otherwise, hide it.
   */
  toggleCustomIndexTitle: function toggleCustomIndexTitle() {
    var selectedIndexTitle = $(this).val();

    if ('custom' === selectedIndexTitle) {
      BDB_Book_Index_Title.indexTitleCustomField.slideDown().css('display', 'block');
    } else {
      BDB_Book_Index_Title.indexTitleCustomField.slideUp();
    }
  },

  /**
   * Copies the contents of the original "Book Title" field to the "original" index title option.
   */
  writeOriginalTitle: function writeOriginalTitle() {
    BDB_Book_Index_Title.indexTitleSelect.find('option[value="original"]').text($(this).val());
  },

  /**
   * Create an index-friendly version of the entered book title and insert it as an
   * option in the <select> dropdown.
   */
  populateIndexTitles: function populateIndexTitles() {
    var args = {
      title: $(this).val()
    };
    Object(utils__WEBPACK_IMPORTED_MODULE_0__["apiRequest"])('v1/book/index-title', args, 'GET').then(function (response) {
      BDB_Book_Index_Title.indexTitleSelect.find('option[value="original"]').after('<option value="' + response + '">' + response + '</option>');
    }).catch(function (error) {
      console.log('Index title generation error', error);
    });
  }
};

/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! jquery */ "jquery")))

/***/ }),

/***/ "./assets/js/src/admin/modules/book-layout.js":
/*!****************************************************!*\
  !*** ./assets/js/src/admin/modules/book-layout.js ***!
  \****************************************************/
/*! exports provided: BDB_Book_Layout */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* WEBPACK VAR INJECTION */(function($) {/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "BDB_Book_Layout", function() { return BDB_Book_Layout; });
/* global $, bdbVars, wp */

/**
 * Book Layout
 */
var BDB_Book_Layout = {
  /**
   * Initialize
   */
  init: function init() {
    $('.bdb-book-option-toggle').on('click', this.toggleBookTextarea);
    $('#bdb-book-layout-cover-changer').on('change', this.changeCoverAlignment);
    this.sort();
  },

  /**
   * Toggle the book textarea
   *
   * @param e
   */
  toggleBookTextarea: function toggleBookTextarea(e) {
    $(this).next().slideToggle();
  },

  /**
   * Change the real-time alignment of the book coversss123
   *
   * @param e
   */
  changeCoverAlignment: function changeCoverAlignment(e) {
    var parentDiv = $('#bdb-book-option-cover');
    parentDiv.removeClass(function (index, css) {
      return (css.match(/(^|\s)bdb-book-cover-align-\S+/g) || []).join(' ');
    }).addClass('bdb-book-cover-align-' + $(this).val());
  },
  sort: function sort() {
    $('.bdb-sortable').sortable({
      cancel: '.bdb-no-sort, textarea, input, select',
      connectWith: '.bdb-sortable',
      placeholder: 'bdb-sortable-placeholder',
      update: function update(event, ui) {
        var parentID = ui.item.parent().attr('id');
        var disabledIndicator = ui.item.find('.bdb-book-option-disabled');

        if ($('#' + parentID).hasClass('bdb-sorter-enabled-column')) {
          disabledIndicator.val('false');
        } else {
          disabledIndicator.val('true');
        }
      }
    });
  }
};

/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! jquery */ "jquery")))

/***/ }),

/***/ "./assets/js/src/admin/modules/categories.js":
/*!***************************************************!*\
  !*** ./assets/js/src/admin/modules/categories.js ***!
  \***************************************************/
/*! exports provided: BDB_Categories */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* WEBPACK VAR INJECTION */(function($) {/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "BDB_Categories", function() { return BDB_Categories; });
/* global $, bdbVars, wp */

/**
 * Category style checkboxes
 */
var BDB_Categories = {
  /**
   * Initialize
   */
  init: function init() {
    $('.bdb-new-checkbox-term').on('click', '.button', this.addCheckboxTerm);
    $('.bdb-new-checkbox-term-value').on('keypress', this.addCheckboxTerm);
  },
  addCheckboxTerm: function addCheckboxTerm(e) {
    if ('click' === e.type) {
      e.preventDefault();
    }

    if ('keypress' === e.type && 13 !== e.which) {
      return true;
    } else {
      e.preventDefault();
    }

    var wrap = $(this).closest('.bdb-taxonomy-checkboxes'),
        checkboxName = wrap.data('name'),
        checkboxTaxonomy = wrap.data('taxonomy'),
        checkboxWrap = wrap.find('.bdb-checkbox-wrap'),
        newTerm = wrap.find('.bdb-new-checkbox-term-value'),
        elID = BDB_Categories.createID(newTerm.val(), checkboxTaxonomy + '-');
    checkboxWrap.append('<label for="' + elID + '"><input type="checkbox" id="' + elID + '" name="' + checkboxName + '" class="bdb" value="' + newTerm.val() + '" checked="checked"> ' + newTerm.val() + '</label>');
    newTerm.val('');
  },
  createID: function createID(value, prefix) {
    return value.replace(/[^a-z0-9]/g, function (s) {
      var c = s.charCodeAt(0);

      if (32 === c) {
        return '-';
      }

      if (c >= 65 && c <= 90) {
        return prefix + s.toLowerCase();
      }

      return prefix + ('000' + c.toString(16)).slice(-4);
    });
  }
};

/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! jquery */ "jquery")))

/***/ }),

/***/ "./assets/js/src/admin/modules/media-upload.js":
/*!*****************************************************!*\
  !*** ./assets/js/src/admin/modules/media-upload.js ***!
  \*****************************************************/
/*! exports provided: BDB_Media */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* WEBPACK VAR INJECTION */(function($) {/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "BDB_Media", function() { return BDB_Media; });
/* global $, bdbVars, wp */

/**
 * Interface with the WP media modal
 */
var BDB_Media = {
  frame: false,

  /**
   * Initialize
   */
  init: function init() {
    $('.bdb-upload-image').on('click', this.createFrame);
    $('.bdb-remove-image').on('click', this.removeImage);
  },

  /**
   * Create and open the media frame
   *
   * @param e
   */
  createFrame: function createFrame(e) {
    e.preventDefault();
    var button = $(this),
        imageField = $(this).parent().data('image'),
        imageIDField = $(this).parent().data('image-id'),
        imageSize = $(this).parent().data('image-size');

    if (!imageSize || 'undefined' === typeof imageSize) {
      imageSize = 'medium';
    } // Create the media frame.


    BDB_Media.frame = wp.media.frames.bookDB = wp.media({
      title: button.data('choose'),
      button: {
        text: button.data('update')
      },
      states: [new wp.media.controller.Library({
        title: button.data('choose'),
        filterable: 'all',
        multiple: false
      })]
    }); // When an image is selected, run a callback.

    BDB_Media.frame.on('select', function () {
      var selection = BDB_Media.frame.state().get('selection');
      selection.map(function (attachment) {
        attachment = attachment.toJSON();

        if (attachment.id) {
          $(imageIDField).val(attachment.id);
          var attachmentImage = attachment.sizes && attachment.sizes[imageSize] ? attachment.sizes[imageSize].url : attachment.url; // Remove all image attributes.

          if ('undefined' !== typeof $(imageField).attributes) {
            while ($(imageField).attributes.length > 0) {
              elem.removeAttribute(elem.attributes[0].name);
            }
          } // Update image src and alt text, then show image.


          $(imageField).attr('src', attachmentImage).attr('alt', attachment.alt).show(); // Show remove button.

          button.parent().find('.bdb-remove-image').show();
        }
      });
    }); // Finally, open the modal.

    BDB_Media.frame.open();
  },

  /**
   * Remove the chosen image
   *
   * @param e
   */
  removeImage: function removeImage(e) {
    e.preventDefault();
    var button = $(this),
        imageField = button.parent().data('image'),
        imageIDField = button.parent().data('image-id'); // Remove image attributes and hide.

    if ('undefined' !== typeof $(imageField).attributes) {
      while ($(imageField).attributes.length > 0) {
        elem.removeAttribute(elem.attributes[0].name);
      }
    }

    $(imageField).hide(); // Delete image ID value.

    $(imageIDField).val(''); // Now hide the remove button.

    button.hide();
  }
};

/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! jquery */ "jquery")))

/***/ }),

/***/ "./assets/js/src/admin/modules/tags.js":
/*!*********************************************!*\
  !*** ./assets/js/src/admin/modules/tags.js ***!
  \*********************************************/
/*! exports provided: BDB_Tags */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* WEBPACK VAR INJECTION */(function($) {/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "BDB_Tags", function() { return BDB_Tags; });
/* global $, bdbVars, wp */

/**
 * Autocomplete for tags
 */
var BDB_Tags = {
  tag: false,

  /**
   * Initialize
   */
  init: function init() {
    this.tag = $('.bdb-ajaxtag');

    if (!this.tag.length) {
      return;
    }

    $('.bdb-tags-wrap').each(function () {
      BDB_Tags.quickClicks($(this));
    });
    $('.button', BDB_Tags.tag).on('click', function () {
      BDB_Tags.flushTags($(this).closest('.bdb-tags-wrap'));
    });
    BDB_Tags.tag.each(function () {
      var newTag = $('.bdb-new-tag', $(this));
      var taxonomy = $(this).closest('.bdb-tags-wrap').data('taxonomy');
      var apiURL = bdbVars.api_base + 'book-database/v1/book-term/suggest/?taxonomy=' + taxonomy + '&format=text&_wpnonce=' + bdbVars.api_nonce;

      if ('author' === taxonomy) {
        apiURL = bdbVars.api_base + 'book-database/v1/author/suggest/?format=text&_wpnonce=' + bdbVars.api_nonce;
      }

      newTag.on('keyup', function (e) {
        if (13 === e.which) {
          BDB_Tags.flushTags($(this).closest('.bdb-tags-wrap'));
          return false;
        }
      }).on('keypress', function (e) {
        if (13 === e.which) {
          e.preventDefault();
          return false;
        }
      }).suggest(apiURL);
    });
    $('#bdb-book-series-name').suggest(bdbVars.api_base + 'book-database/v1/series/suggest/?format=text&_wpnonce=' + bdbVars.api_nonce); // Save tags on save/publish

    $('.bdb-admin-page > form').on('submit', function (e) {
      $('.bdb-tags-wrap').each(function () {
        BDB_Tags.flushTags(this, false, 1);
      });
    });
  },

  /**
   * Clean tags
   *
   * @param tags
   */
  clean: function clean(tags) {
    return tags.replace(/\s*,\s*/g, ',').replace(/,+/g, ',').replace(/[,\s]+$/, '').replace(/^[,\s]+/, '');
  },

  /**
   * Parse tags
   *
   * @param el
   */
  parseTags: function parseTags(el) {
    var id = el.id;
    var num = id.split('-check-num-')[1];
    var tagBox = $(el).closest('.bdb-tags-wrap');
    var theTags = tagBox.find('textarea');
    var currentTags = theTags.val().split(',');
    var newTags = [];
    delete currentTags[num];
    $.each(currentTags, function (key, val) {
      val = $.trim(val);

      if (val) {
        newTags.push(val);
      }
    });
    theTags.val(BDB_Tags.clean(newTags.join(',')));
    BDB_Tags.quickClicks(tagBox);
    return false;
  },

  /**
   * Handles adding tags
   *
   * @param el
   */
  quickClicks: function quickClicks(el) {
    var theTags = $('textarea', el);
    var tagChecklist = $('.bdb-tags-checklist', el);
    var id = $(el).attr('id');
    var currentTags;
    var disabled;

    if (!theTags.length) {
      return;
    }

    disabled = theTags.prop('disabled');
    currentTags = theTags.val().split(',');
    tagChecklist.empty();
    $.each(currentTags, function (key, val) {
      var span, xbutton;
      val = $.trim(val);

      if (!val) {
        return;
      } // Create a new span and ensure the text is properly escaped.


      span = $('<span />').text(val); // If tags editing isn't disabled, create the X button.

      if (!disabled) {
        xbutton = $('<a id="' + id + '-check-num-' + key + '" class="ntdelbutton">X</a>');
        xbutton.on('click', function (e) {
          BDB_Tags.parseTags(this);
        });
        span.prepend('&nbsp;').prepend(xbutton);
      } // Append the span to the tag list.


      tagChecklist.append(span);
    });
  },

  /**
   * Flush tags on add tag and save
   *
   * @param el
   * @param a
   * @param f
   */
  flushTags: function flushTags(el, a, f) {
    a = a || false;
    var text;
    var tags = $('textarea', el);
    var newTag = $('.bdb-new-tag', el);
    var tagsVal, newTags;
    text = a ? a.text() : newTag.val();
    tagsVal = tags.val();
    newTags = tagsVal ? tagsVal + ',' + text : text;
    newTags = BDB_Tags.clean(newTags);
    newTags = BDB_Tags.uniqueArray(newTags.split(',')).join(',');
    tags.val(newTags);
    BDB_Tags.quickClicks(el);

    if (!a) {
      newTag.val('');
    }

    if ('undefined' === typeof f) {
      newTag.focus();
    }

    return false;
  },

  /**
   * Create a unique array with no empty values
   *
   * @param {array} array
   *
   * @returns {array}
   */
  uniqueArray: function uniqueArray(array) {
    var out = [];
    $.each(array, function (key, val) {
      val = $.trim(val);

      if (val && -1 === $.inArray(val, out)) {
        out.push(val);
      }
    });
    return out;
  }
};

/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! jquery */ "jquery")))

/***/ }),

/***/ "./assets/js/src/admin/modules/taxonomies.js":
/*!***************************************************!*\
  !*** ./assets/js/src/admin/modules/taxonomies.js ***!
  \***************************************************/
/*! exports provided: BDB_Book_Taxonomies */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* WEBPACK VAR INJECTION */(function($) {/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "BDB_Book_Taxonomies", function() { return BDB_Book_Taxonomies; });
/* harmony import */ var utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! utils */ "./assets/js/src/utils/index.js");
/* global $, bdbVars, wp */

/**
 * Book Taxonomies
 */

var BDB_Book_Taxonomies = {
  tableBody: false,
  rowTemplate: wp.template('bdb-book-taxonomies-table-row'),
  rowEmptyTemplate: wp.template('bdb-book-taxonomies-table-row-empty'),
  errorWrap: '',

  /**
   * Initialize
   */
  init: function init() {
    this.tableBody = $('#bdb-book-taxonomies tbody');
    this.errorWrap = $('#bdb-book-taxonomies-errors');

    if (!this.tableBody.length) {
      return;
    }

    $('#bdb-new-book-taxonomy-name').on('keyup', this.generateSlug);
    $('#bdb-new-book-taxonomy-fields').on('click', 'button', this.addTaxonomy);
    $(document).on('click', '.bdb-update-book-taxonomy', this.updateTaxonomy);
    $(document).on('click', '.bdb-remove-book-taxonomy', this.deleteTaxonomy);
    this.getTaxonomies();
  },

  /**
   * Get the list of taxonomies
   */
  getTaxonomies: function getTaxonomies() {
    Object(utils__WEBPACK_IMPORTED_MODULE_0__["apiRequest"])('v1/taxonomy', {}, 'GET').then(function (response) {
      BDB_Book_Taxonomies.tableBody.empty();

      if (0 === response.length || 'undefined' === typeof response.length) {
        BDB_Book_Taxonomies.tableBody.append(BDB_Book_Taxonomies.rowEmptyTemplate);
      } else {
        $('#bdb-book-taxonomies-empty').remove();
        $.each(response, function (key, taxonomy) {
          BDB_Book_Taxonomies.tableBody.append(BDB_Book_Taxonomies.rowTemplate(taxonomy));
        });
      }
    }).catch(function (error) {
      BDB_Book_Taxonomies.errorWrap.empty().append(error).show();
    });
  },

  /**
   * Automatically generate a slug from the name
   *
   * @param e
   */
  generateSlug: function generateSlug(e) {
    var name = $('#bdb-new-book-taxonomy-name').val();
    var slug = name.toLowerCase().replace(/[^a-z0-9_\-]/g, '');
    $('#bdb-new-book-taxonomy-slug').val(slug);
  },

  /**
   * Add a new taxonomy
   *
   * @param e
   */
  addTaxonomy: function addTaxonomy(e) {
    e.preventDefault();
    var button = $(this);
    Object(utils__WEBPACK_IMPORTED_MODULE_0__["spinButton"])(button);
    BDB_Book_Taxonomies.errorWrap.empty().hide();
    var args = {
      name: $('#bdb-new-book-taxonomy-name').val(),
      slug: $('#bdb-new-book-taxonomy-slug').val(),
      format: $('#bdb-new-book-taxonomy-format').val()
    };
    BDB_Book_Taxonomies.checkRequiredFields(args).then(function (requirementsResponse) {
      return Object(utils__WEBPACK_IMPORTED_MODULE_0__["apiRequest"])('v1/taxonomy/add', args, 'POST');
    }).then(function (apiResponse) {
      BDB_Book_Taxonomies.tableBody.append(BDB_Book_Taxonomies.rowTemplate(apiResponse)); // Wipe field values.

      $('#bdb-new-book-taxonomy-fields').find('input').val('');
      Object(utils__WEBPACK_IMPORTED_MODULE_0__["unspinButton"])(button);
    }).catch(function (errorMessage) {
      BDB_Book_Taxonomies.errorWrap.append(errorMessage).show();
      Object(utils__WEBPACK_IMPORTED_MODULE_0__["unspinButton"])(button);
    });
  },

  /**
   * Update a taxonomy
   *
   * @param e
   */
  updateTaxonomy: function updateTaxonomy(e) {
    e.preventDefault();
    var button = $(this);
    Object(utils__WEBPACK_IMPORTED_MODULE_0__["spinButton"])(button);
    BDB_Book_Taxonomies.errorWrap.empty().hide();
    var wrap = button.closest('tr');
    var args = {
      name: wrap.find('.bdb-book-taxonomy-name input').val(),
      slug: wrap.find('.bdb-book-taxonomy-slug input').val(),
      format: wrap.find('.bdb-book-taxonomy-format select').val()
    };
    BDB_Book_Taxonomies.checkRequiredFields(args).then(function (requirementsResponse) {
      return Object(utils__WEBPACK_IMPORTED_MODULE_0__["apiRequest"])('v1/taxonomy/update/' + wrap.data('id'), args, 'POST');
    }).then(function (apiResponse) {
      Object(utils__WEBPACK_IMPORTED_MODULE_0__["unspinButton"])(button);
    }).catch(function (errorMessage) {
      BDB_Book_Taxonomies.errorWrap.append(errorMessage).show();
      Object(utils__WEBPACK_IMPORTED_MODULE_0__["unspinButton"])(button);
    });
  },
  deleteTaxonomy: function deleteTaxonomy(e) {
    e.preventDefault();

    if (!confirm(bdbVars.confirm_delete_taxonomy)) {
      return false;
    }

    var button = $(this);
    Object(utils__WEBPACK_IMPORTED_MODULE_0__["spinButton"])(button);
    BDB_Book_Taxonomies.errorWrap.empty().hide();
    var wrap = button.closest('tr');
    Object(utils__WEBPACK_IMPORTED_MODULE_0__["apiRequest"])('v1/taxonomy/delete/' + wrap.data('id'), {}, 'DELETE').then(function (apiResponse) {
      wrap.remove();
    }).catch(function (errorMessage) {
      BDB_Book_Taxonomies.errorWrap.append(errorMessage).show();
      Object(utils__WEBPACK_IMPORTED_MODULE_0__["unspinButton"])(button);
    });
  },

  /**
   * Check required fields are filled out
   *
   * @param {object} args
   * @returns {Promise}
   */
  checkRequiredFields: function checkRequiredFields(args) {
    return new Promise(function (resolve, reject) {
      if (!args.hasOwnProperty('name') || '' === args.name) {
        reject(bdbVars.error_required_fields);
        return;
      }

      if (!args.hasOwnProperty('slug') || '' === args.slug) {
        reject(bdbVars.error_required_fields);
        return;
      }

      if (!args.hasOwnProperty('format') || '' === args.format) {
        reject(bdbVars.error_required_fields);
        return;
      }

      resolve();
    });
  }
};

/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! jquery */ "jquery")))

/***/ }),

/***/ "./assets/js/src/utils/api-request.js":
/*!********************************************!*\
  !*** ./assets/js/src/utils/api-request.js ***!
  \********************************************/
/*! exports provided: apiRequest */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* WEBPACK VAR INJECTION */(function($) {/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "apiRequest", function() { return apiRequest; });
/* global $, bdbVars */

/**
 * Make a request to the REST API
 *
 * @param {string} endpoint
 * @param {object} data
 * @param {string} method
 * @returns {Promise}
 */
function apiRequest(endpoint) {
  var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
  var method = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'POST';
  var options = {
    method: method,
    url: bdbVars.api_base + 'book-database/' + endpoint,
    beforeSend: function beforeSend(xhr) {
      xhr.setRequestHeader('X-WP-Nonce', bdbVars.api_nonce);
    },
    xhrFields: {
      withCredentials: true
    },
    data: data
  };
  console.log('API endpoint', endpoint);
  return new Promise(function (resolve, reject) {
    $.ajax(options).success(function (response) {
      console.log('Success response', response);
      resolve(response);
    }).error(function (qpXHR, textStatus, errorThrown) {
      var error = bdbVars.generic_erroc;

      if ('undefined' !== typeof qpXHR.responseJSON) {
        error = qpXHR.responseJSON;

        if ('undefined' !== typeof error.message) {
          error = error.message;
        }
      } else if ('undefined' !== typeof qpXHR.message) {
        error = qpXHR.message;
      }

      reject(error);
    });
  });
}
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! jquery */ "jquery")))

/***/ }),

/***/ "./assets/js/src/utils/index.js":
/*!**************************************!*\
  !*** ./assets/js/src/utils/index.js ***!
  \**************************************/
/*! exports provided: apiRequest, spinButton, unspinButton */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_request_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./api-request.js */ "./assets/js/src/utils/api-request.js");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "apiRequest", function() { return _api_request_js__WEBPACK_IMPORTED_MODULE_0__["apiRequest"]; });

/* harmony import */ var _loaders_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./loaders.js */ "./assets/js/src/utils/loaders.js");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "spinButton", function() { return _loaders_js__WEBPACK_IMPORTED_MODULE_1__["spinButton"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "unspinButton", function() { return _loaders_js__WEBPACK_IMPORTED_MODULE_1__["unspinButton"]; });




/***/ }),

/***/ "./assets/js/src/utils/loaders.js":
/*!****************************************!*\
  !*** ./assets/js/src/utils/loaders.js ***!
  \****************************************/
/*! exports provided: spinButton, unspinButton */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "spinButton", function() { return spinButton; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "unspinButton", function() { return unspinButton; });
/* global $, bdbVars */

/**
 * Spin a button
 *
 *      - Disables the button
 *      - Saves the current button text to `data-text`
 *      - Changes the text to either a WP-Admin spinner or "Please Wait..."
 *
 * @param button
 */
function spinButton(button) {
  var newText = bdbVars.is_admin ? '<span class="spinner is-active"></span>' : bdbVars.please_wait;
  button.prop('disabled', true).data('text', button.text()).html(newText);
}
/**
 * Unspin a button
 *
 *      - Enables teh button
 *      - Sets the text to the `data-text` attribute value
 *
 * @param button
 */

function unspinButton(button) {
  button.prop('disabled', false).text(button.data('text'));
}

/***/ }),

/***/ "jquery":
/*!*************************!*\
  !*** external "jQuery" ***!
  \*************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = jQuery;

/***/ })

/******/ });
//# sourceMappingURL=admin.min.js.map