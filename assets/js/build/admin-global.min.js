!function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=28)}({0:function(e,t,r){"use strict";var n=r(3);function a(e){var t=bdbVars.is_admin?'<span class="spinner is-active"></span>':bdbVars.please_wait;e.prop("disabled",!0).data("text",e.text()).html(t)}function i(e){e.prop("disabled",!1).text(e.data("text"))}function o(e){var t="",r=Math.floor(e),n=Math.ceil(e-r);return t+="&starf;".repeat(r),t+="&half;".repeat(n)}r.d(t,"b",(function(){return n.b})),r.d(t,"a",(function(){return n.a})),r.d(t,"d",(function(){return a})),r.d(t,"e",(function(){return i})),r.d(t,"c",(function(){return o}))},1:function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return o}));var n="YYYY-MM-DD HH:mm:ss",a="MMMM D, YYYY";function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"mysql";return""!==e&&e?(t="display"===t?a:n,(e=moment.utc(e)).local().format(t)):""}function o(e){return""!==e&&e?(e=moment(e)).utc().format(n):""}},19:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return a}));var n=r(0),a={init:function(){e(".bdb-currently-reading-widget-update-progress").on("click",this.updatePercentage),e(".bdb-currently-reading-progress-unit-choices").on("click","a",this.setUnit),e(".bdb-currently-reading-widget-save-progress").on("click",this.saveProgress),e(".bdb-currently-reading-set-progress-wrap").on("keydown","input",this.saveProgressOnEnter),e(".bdb-currently-reading-widget-finish-book").on("click",this.finishBook),e(".bdb-currently-reading-widget-dnf-book").on("click",this.dnfBook),e(".bdb-currently-reading-widget-set-rating").on("click",this.setRating)},updatePercentage:function(t){t.preventDefault(),e(this).closest("li").find(".bdb-currently-reading-set-progress-wrap").slideToggle()},setUnit:function(t){t.preventDefault();var r=e(this).closest(".bdb-currently-reading-set-progress-wrap"),n=e(this).data("unit");r.find(".bdb-currently-reading-progress-unit-choices a").removeClass("bdb-currently-reading-progress-unit-selected"),e(this).addClass("bdb-currently-reading-progress-unit-selected"),"page"===n?(r.find(".bdb-currently-reading-unit-percentage-wrap").hide(),r.find(".bdb-currently-reading-unit-pages-wrap").show()):(r.find(".bdb-currently-reading-unit-percentage-wrap").show(),r.find(".bdb-currently-reading-unit-pages-wrap").hide())},saveProgress:function(t){t.preventDefault();var r,a=e(this),i=a.closest("li"),o=i.data("log-id"),s=i.find(".bdb-currently-reading-progress-unit-selected").data("unit"),d=0,c=i.find(".bdb-currently-reading-progress-bar"),u=i.find(".bdb-currently-reading-progress-number");if(Object(n.d)(a),"page"===s){var l=i.find(".bdb-currently-reading-unit-page"),b=parseInt(l.data("max")),f=parseInt(l.val());b>0&&(d=f/b,r=Math.round(100*d))}else{var p=i.find(".bdb-currently-reading-unit-percentage");(r=parseFloat(p.val()))>0&&(d=r/100)}var h={percentage_complete:d};Object(n.b)("v1/reading-log/update/"+o,h,"POST").then((function(e){c.css("width",r+"%"),u.text(r+"%")})).catch((function(e){console.log(e)})).finally((function(){Object(n.e)(a),i.find(".bdb-currently-reading-set-progress-wrap").slideUp()}))},saveProgressOnEnter:function(t){13===t.keyCode&&(t.preventDefault(),e(this).closest("li").find(".bdb-currently-reading-widget-save-progress").trigger("click"))},finishBook:function(t){if(t.preventDefault(),!confirm(bdbVars.confirm_finish_book))return!1;var r=e(this);Object(n.d)(r);var a=r.closest("li"),i={percentage_complete:1,date_finished:a.data("now")};Object(n.b)("v1/reading-log/update/"+a.data("log-id"),i,"POST").then((function(e){a.find(".bdb-currently-reading-data").remove(),a.find(".bdb-currently-reading-rate-book").show()})).catch((function(e){console.log(e)})).finally((function(){Object(n.e)(r)}))},dnfBook:function(t){if(t.preventDefault(),!confirm(bdbVars.confirm_dnf_book))return!1;var r=e(this);Object(n.d)(r);var a=r.closest("li"),i={date_finished:a.data("now")};Object(n.b)("v1/reading-log/update/"+a.data("log-id"),i,"POST").then((function(e){a.find(".bdb-currently-reading-data").remove(),a.find(".bdb-currently-reading-rate-book").show()})).catch((function(e){console.log(e)})).finally((function(){Object(n.e)(r)}))},setRating:function(t){t.preventDefault();var r=e(this);Object(n.d)(r);var a=r.closest("li"),i={rating:a.find(".bdb-currently-reading-rating").val()};Object(n.b)("v1/reading-log/update/"+a.data("log-id"),i,"POST").then((function(e){a.find(".bdb-currently-reading-rate-book").empty().append("<p>"+Object(n.c)(i.rating)+"</p>")})).catch((function(e){console.log(e)})).finally((function(){Object(n.e)(r)}))}}}).call(this,r(2))},2:function(e,t){e.exports=jQuery},20:function(e,t,r){"use strict";(function(e){r.d(t,"a",(function(){return i}));var n=r(0),a=r(1),i={postID:0,userID:0,bookID:0,table:!1,tableBody:!1,errorWrap:!1,searchResultsWrap:!1,init:function(){document.getElementById("bdb-post-reviews-table")&&(this.table=e("#bdb-post-reviews-table"),this.postID=this.table.data("post-id"),this.userID=this.table.data("user-id"),this.tableBody=this.table.find("tbody"),this.errorWrap=e("#bdb-post-reviews-errors"),this.searchResultsWrap=e("#bdb-book-search-results"),this.getReviews(),e("#bdb-associated-review-post").on("click",this.toggleSearch),e("#bdb-search-book-title-author").on("keypress",this.searchBooks),e("#bdb-search-book-fields").on("click","button",this.searchBooks),this.searchResultsWrap.on("click","a",this.selectBook),e("#bdb-add-review").on("click",this.addReview),e(document).on("click",".bdb-disassociate-review-from-post",this.disassociateReview),e(document).on("click",".bdb-delete-review",this.deleteReview))},getReviews:function(){var t={rating_format:"text",review_query:[{field:"post_id",value:i.postID}]};Object(n.b)("v1/reviews",t,"GET").then((function(t){i.tableBody.empty(),0===t.length||void 0===t.length?i.tableBody.append(wp.template("bdb-table-post-reviews-row-empty")):e.each(t,(function(e,t){i.tableBody.append(wp.template("bdb-table-post-reviews-row")(t))}))})).catch((function(e){i.errorWrap.empty().append(e).show()}))},toggleSearch:function(t){t.preventDefault(),e("#bdb-search-book-fields").slideToggle()},searchBooks:function(t){if("click"===t.type&&t.preventDefault(),"keypress"===t.type&&13!==t.which)return!0;t.preventDefault();var r=e("#bdb-search-book-fields").find("button"),a=e("#bdb-search-book-title-author").val(),o=e("#bdb-search-book-type").val(),s={};Object(n.d)(r),i.errorWrap.empty().hide(),i.searchResultsWrap.empty(),"author"===o?s.author_query=[{field:"name",value:a,operator:"LIKE"}]:s.book_query=[{field:"title",value:a,operator:"LIKE"}],Object(n.b)("v1/books",s,"GET").then((function(t){if(0===t.length||void 0===t.length)i.searchResultsWrap.append("<p>"+bdbVars.no_books+"</p>");else{var r="";e.each(t,(function(e,t){r=r+'<li><a href="#" data-id="'+t.id+'">'+t.title+" "+bdbVars.by+" "+t.author_name+"</a></li>"})),i.searchResultsWrap.append("<ul>"+r+"</ul>")}})).catch((function(e){i.errorWrap.append(e).show()})).finally((function(){Object(n.e)(r)}))},selectBook:function(t){t.preventDefault(),i.bookID=e(this).data("id"),i.searchResultsWrap.empty().append("<p>"+bdbVars.please_wait+"</p>");var r={book_id:e(this).data("id")};Object(n.b)("v1/reading-log",r,"GET").then((function(t){var r=e("#bdb-review-reading-log");t.length>0&&e.each(t,(function(e,t){r.append('<option value="'+t.id+'">'+i.shapeLog(t)+"</option>")})),i.searchResultsWrap.empty(),e("#bdb-add-review-fields").show()})).catch((function(e){i.errorWrap.append(e).show()}))},shapeLog:function(e){return e.date_started_formatted=Object(a.b)(e.date_started,"display"),e.date_finished_formatted=Object(a.b)(e.date_finished,"display"),e.rating=null===e.rating?null:parseFloat(e.rating)+" "+bdbVars.stars,e.date_started_formatted||(e.date_started_formatted="("+bdbVars.unknown+")"),e.date_finished_formatted||(e.date_finished_formatted="("+bdbVars.unknown+")"),e.date_started_formatted+" - "+e.date_finished_formatted+" ("+e.rating+")"},addReview:function(t){t.preventDefault();var r=e(this);Object(n.d)(r);var a={book_id:i.bookID,reading_log_id:e("#bdb-review-reading-log").val(),user_id:i.userID,post_id:i.postID};Object(n.b)("v1/review/add",a,"POST").then((function(e){var t={rating_format:"text",review_query:[{field:"id",value:e.id}]};return Object(n.b)("v1/reviews",t,"GET")})).then((function(t){e.each(t,(function(t,r){e("#bdb-no-post-reviews").remove(),i.tableBody.append(wp.template("bdb-table-post-reviews-row")(r))})),e("#bdb-add-review-fields").hide()})).catch((function(e){i.errorWrap.append(e).show()})).finally((function(){Object(n.e)(r)}))},disassociateReview:function(t){if(t.preventDefault(),!confirm(bdbVars.confirm_remove_review_association))return!1;var r=e(this);Object(n.d)(r),i.errorWrap.empty().hide();var a=r.closest("tr");Object(n.b)("v1/review/update/"+a.data("id"),{post_id:null},"POST").then((function(e){a.remove()})).catch((function(e){i.errorWrap.append(e).show()})).finally((function(){Object(n.e)(r)}))},deleteReview:function(t){if(t.preventDefault(),!confirm(bdbVars.confirm_delete_review))return!1;var r=e(this);Object(n.d)(r),i.errorWrap.empty().hide();var a=r.closest("tr");Object(n.b)("v1/review/delete/"+a.data("id"),{post_id:null},"DELETE").then((function(e){a.remove()})).catch((function(e){i.errorWrap.append(e).show()})).finally((function(){Object(n.e)(r)}))}}}).call(this,r(2))},28:function(e,t,r){"use strict";r.r(t);var n=r(19),a=r(20);jQuery,n.a.init(),a.a.init()},3:function(e,t,r){"use strict";(function(e){function n(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={method:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST",url:bdbVars.api_base+"book-database/"+t,beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",bdbVars.api_nonce)},xhrFields:{withCredentials:!0},data:r};return new Promise((function(t,r){e.ajax(n).success((function(e){t(e)})).error((function(e,t,n){var a=bdbVars.generic_erroc;void 0!==e.responseJSON?void 0!==(a=e.responseJSON).message&&(a=a.message):void 0!==e.message&&(a=e.message),r(a)}))}))}function a(t){var r={method:"POST",dataType:"JSON",url:ajaxurl,data:t};return new Promise((function(t,n){e.ajax(r).success((function(e){e.success?t(e.data):n(e.data)})).error((function(e,t,r){var a=bdbVars.generic_erroc;void 0!==e.responseJSON?void 0!==(a=e.responseJSON).message&&(a=a.message):void 0!==e.message&&(a=e.message),n(a)}))}))}r.d(t,"b",(function(){return n})),r.d(t,"a",(function(){return a}))}).call(this,r(2))}});
//# sourceMappingURL=admin-global.min.js.map