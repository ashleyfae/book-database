/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./assets/js/src/admin/index.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./assets/js/src/admin/index.js":
/*!**************************************!*\
  !*** ./assets/js/src/admin/index.js ***!
  \**************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _modules_book_layout_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./modules/book-layout.js */ "./assets/js/src/admin/modules/book-layout.js");
/* harmony import */ var _modules_taxonomies_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./modules/taxonomies.js */ "./assets/js/src/admin/modules/taxonomies.js");
/* harmony import */ var _modules_book_index_title__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./modules/book-index-title */ "./assets/js/src/admin/modules/book-index-title.js");
/**
 * Admin Scripts
 *
 * @package book-database
 * @copyright Copyright (c) 2019, Ashley Gibson
 * @license GPL2+
 */




(function ($) {
  _modules_book_layout_js__WEBPACK_IMPORTED_MODULE_0__["BDB_Book_Layout"].init();
  _modules_taxonomies_js__WEBPACK_IMPORTED_MODULE_1__["BDB_Book_Taxonomies"].init();
  _modules_book_index_title__WEBPACK_IMPORTED_MODULE_2__["BDB_Book_Index_Title"].init();
})(jQuery);

/***/ }),

/***/ "./assets/js/src/admin/modules/book-index-title.js":
/*!*********************************************************!*\
  !*** ./assets/js/src/admin/modules/book-index-title.js ***!
  \*********************************************************/
/*! exports provided: BDB_Book_Index_Title */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* WEBPACK VAR INJECTION */(function($) {/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "BDB_Book_Index_Title", function() { return BDB_Book_Index_Title; });
/* harmony import */ var utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! utils */ "./assets/js/src/utils/index.js");
/* global $, bdbVars, wp */

var BDB_Book_Index_Title = {
  bookTitleField: false,
  indexTitleSelect: false,
  indexTitleCustomField: false,

  /**
   * Initialize
   */
  init: function init() {
    this.bookTitleField = $('#bdb-book-title');
    this.indexTitleSelect = $('#bdb-book-index-title');
    this.indexTitleCustomField = $('#bdb-book-index-title-custom');
    this.indexTitleSelect.on('change', this.toggleCustomIndexTitle).trigger('change');
    this.bookTitleField.on('keyup', this.writeOriginalTitle);
    this.bookTitleField.on('blur', this.populateIndexTitles);
  },

  /**
   * Show the "Custom" box if "Custom" is selected. Otherwise, hide it.
   */
  toggleCustomIndexTitle: function toggleCustomIndexTitle() {
    var selectedIndexTitle = $(this).val();

    if ('custom' === selectedIndexTitle) {
      BDB_Book_Index_Title.indexTitleCustomField.slideDown().css('display', 'block');
    } else {
      BDB_Book_Index_Title.indexTitleCustomField.slideUp();
    }
  },

  /**
   * Copies the contents of the original "Book Title" field to the "original" index title option.
   */
  writeOriginalTitle: function writeOriginalTitle() {
    BDB_Book_Index_Title.indexTitleSelect.find('option[value="original"]').text($(this).val());
  },

  /**
   * Create an index-friendly version of the entered book title and insert it as an
   * option in the <select> dropdown.
   */
  populateIndexTitles: function populateIndexTitles() {
    var args = {
      title: $(this).val()
    };
    Object(utils__WEBPACK_IMPORTED_MODULE_0__["apiRequest"])('v1/book/index-title', args, 'GET').then(function (response) {
      BDB_Book_Index_Title.indexTitleSelect.find('option[value="original"]').after('<option value="' + response + '">' + response + '</option>');
    }).catch(function (error) {
      console.log('Index title generation error', error);
    });
  }
};

/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! jquery */ "jquery")))

/***/ }),

/***/ "./assets/js/src/admin/modules/book-layout.js":
/*!****************************************************!*\
  !*** ./assets/js/src/admin/modules/book-layout.js ***!
  \****************************************************/
/*! exports provided: BDB_Book_Layout */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* WEBPACK VAR INJECTION */(function($) {/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "BDB_Book_Layout", function() { return BDB_Book_Layout; });
/* global $, bdbVars, wp */

/**
 * Book Layout
 */
var BDB_Book_Layout = {
  /**
   * Initialize
   */
  init: function init() {
    $('.bdb-book-option-toggle').on('click', this.toggleBookTextarea);
    $('#bdb-book-layout-cover-changer').on('change', this.changeCoverAlignment);
    this.sort();
  },

  /**
   * Toggle the book textarea
   *
   * @param e
   */
  toggleBookTextarea: function toggleBookTextarea(e) {
    $(this).next().slideToggle();
  },

  /**
   * Change the real-time alignment of the book coversss123
   *
   * @param e
   */
  changeCoverAlignment: function changeCoverAlignment(e) {
    var parentDiv = $('#bdb-book-option-cover');
    parentDiv.removeClass(function (index, css) {
      return (css.match(/(^|\s)bdb-book-cover-align-\S+/g) || []).join(' ');
    }).addClass('bdb-book-cover-align-' + $(this).val());
  },
  sort: function sort() {
    $('.bdb-sortable').sortable({
      cancel: '.bdb-no-sort, textarea, input, select',
      connectWith: '.bdb-sortable',
      placeholder: 'bdb-sortable-placeholder',
      update: function update(event, ui) {
        var parentID = ui.item.parent().attr('id');
        var disabledIndicator = ui.item.find('.bdb-book-option-disabled');

        if ($('#' + parentID).hasClass('bdb-sorter-enabled-column')) {
          disabledIndicator.val('false');
        } else {
          disabledIndicator.val('true');
        }
      }
    });
  }
};

/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! jquery */ "jquery")))

/***/ }),

/***/ "./assets/js/src/admin/modules/taxonomies.js":
/*!***************************************************!*\
  !*** ./assets/js/src/admin/modules/taxonomies.js ***!
  \***************************************************/
/*! exports provided: BDB_Book_Taxonomies */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* WEBPACK VAR INJECTION */(function($) {/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "BDB_Book_Taxonomies", function() { return BDB_Book_Taxonomies; });
/* harmony import */ var utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! utils */ "./assets/js/src/utils/index.js");
/* global $, bdbVars, wp */

/**
 * Book Taxonomies
 */

var BDB_Book_Taxonomies = {
  tableBody: false,
  rowTemplate: wp.template('bdb-book-taxonomies-table-row'),
  rowEmptyTemplate: wp.template('bdb-book-taxonomies-table-row-empty'),
  errorWrap: '',

  /**
   * Initialize
   */
  init: function init() {
    this.tableBody = $('#bdb-book-taxonomies tbody');
    this.errorWrap = $('#bdb-book-taxonomies-errors');

    if (!this.tableBody.length) {
      return;
    }

    $('#bdb-new-book-taxonomy-name').on('keyup', this.generateSlug);
    $('#bdb-new-book-taxonomy-fields').on('click', 'button', this.addTaxonomy);
    $(document).on('click', '.bdb-update-book-taxonomy', this.updateTaxonomy);
    $(document).on('click', '.bdb-remove-book-taxonomy', this.deleteTaxonomy);
    this.getTaxonomies();
  },

  /**
   * Get the list of taxonomies
   */
  getTaxonomies: function getTaxonomies() {
    Object(utils__WEBPACK_IMPORTED_MODULE_0__["apiRequest"])('v1/taxonomy', {}, 'GET').then(function (response) {
      BDB_Book_Taxonomies.tableBody.empty();

      if (0 === response.length || 'undefined' === typeof response.length) {
        BDB_Book_Taxonomies.tableBody.append(BDB_Book_Taxonomies.rowEmptyTemplate);
      } else {
        $('#bdb-book-taxonomies-empty').remove();
        $.each(response, function (key, taxonomy) {
          BDB_Book_Taxonomies.tableBody.append(BDB_Book_Taxonomies.rowTemplate(taxonomy));
        });
      }
    }).catch(function (error) {
      BDB_Book_Taxonomies.errorWrap.empty().append(error).show();
    });
  },

  /**
   * Automatically generate a slug from the name
   *
   * @param e
   */
  generateSlug: function generateSlug(e) {
    var name = $('#bdb-new-book-taxonomy-name').val();
    var slug = name.toLowerCase().replace(/[^a-z0-9_\-]/g, '');
    $('#bdb-new-book-taxonomy-slug').val(slug);
  },

  /**
   * Add a new taxonomy
   *
   * @param e
   */
  addTaxonomy: function addTaxonomy(e) {
    e.preventDefault();
    var button = $(this);
    Object(utils__WEBPACK_IMPORTED_MODULE_0__["spinButton"])(button);
    BDB_Book_Taxonomies.errorWrap.empty().hide();
    var args = {
      name: $('#bdb-new-book-taxonomy-name').val(),
      slug: $('#bdb-new-book-taxonomy-slug').val(),
      format: $('#bdb-new-book-taxonomy-format').val()
    };
    BDB_Book_Taxonomies.checkRequiredFields(args).then(function (requirementsResponse) {
      return Object(utils__WEBPACK_IMPORTED_MODULE_0__["apiRequest"])('v1/taxonomy/add', args, 'POST');
    }).then(function (apiResponse) {
      BDB_Book_Taxonomies.tableBody.append(BDB_Book_Taxonomies.rowTemplate(apiResponse)); // Wipe field values.

      $('#bdb-new-book-taxonomy-fields').find('input').val('');
      Object(utils__WEBPACK_IMPORTED_MODULE_0__["unspinButton"])(button);
    }).catch(function (errorMessage) {
      BDB_Book_Taxonomies.errorWrap.append(errorMessage).show();
      Object(utils__WEBPACK_IMPORTED_MODULE_0__["unspinButton"])(button);
    });
  },

  /**
   * Update a taxonomy
   *
   * @param e
   */
  updateTaxonomy: function updateTaxonomy(e) {
    e.preventDefault();
    var button = $(this);
    Object(utils__WEBPACK_IMPORTED_MODULE_0__["spinButton"])(button);
    BDB_Book_Taxonomies.errorWrap.empty().hide();
    var wrap = button.closest('tr');
    var args = {
      name: wrap.find('.bdb-book-taxonomy-name input').val(),
      slug: wrap.find('.bdb-book-taxonomy-slug input').val(),
      format: wrap.find('.bdb-book-taxonomy-format select').val()
    };
    BDB_Book_Taxonomies.checkRequiredFields(args).then(function (requirementsResponse) {
      return Object(utils__WEBPACK_IMPORTED_MODULE_0__["apiRequest"])('v1/taxonomy/update/' + wrap.data('id'), args, 'POST');
    }).then(function (apiResponse) {
      Object(utils__WEBPACK_IMPORTED_MODULE_0__["unspinButton"])(button);
    }).catch(function (errorMessage) {
      BDB_Book_Taxonomies.errorWrap.append(errorMessage).show();
      Object(utils__WEBPACK_IMPORTED_MODULE_0__["unspinButton"])(button);
    });
  },
  deleteTaxonomy: function deleteTaxonomy(e) {
    e.preventDefault();

    if (!confirm(bdbVars.confirm_delete_taxonomy)) {
      return false;
    }

    var button = $(this);
    Object(utils__WEBPACK_IMPORTED_MODULE_0__["spinButton"])(button);
    BDB_Book_Taxonomies.errorWrap.empty().hide();
    var wrap = button.closest('tr');
    Object(utils__WEBPACK_IMPORTED_MODULE_0__["apiRequest"])('v1/taxonomy/delete/' + wrap.data('id'), {}, 'DELETE').then(function (apiResponse) {
      wrap.remove();
    }).catch(function (errorMessage) {
      BDB_Book_Taxonomies.errorWrap.append(errorMessage).show();
      Object(utils__WEBPACK_IMPORTED_MODULE_0__["unspinButton"])(button);
    });
  },

  /**
   * Check required fields are filled out
   *
   * @param {object} args
   * @returns {Promise}
   */
  checkRequiredFields: function checkRequiredFields(args) {
    return new Promise(function (resolve, reject) {
      if (!args.hasOwnProperty('name') || '' === args.name) {
        reject(bdbVars.error_required_fields);
        return;
      }

      if (!args.hasOwnProperty('slug') || '' === args.slug) {
        reject(bdbVars.error_required_fields);
        return;
      }

      if (!args.hasOwnProperty('format') || '' === args.format) {
        reject(bdbVars.error_required_fields);
        return;
      }

      resolve();
    });
  }
};

/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! jquery */ "jquery")))

/***/ }),

/***/ "./assets/js/src/utils/api-request.js":
/*!********************************************!*\
  !*** ./assets/js/src/utils/api-request.js ***!
  \********************************************/
/*! exports provided: apiRequest */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* WEBPACK VAR INJECTION */(function($) {/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "apiRequest", function() { return apiRequest; });
/* global $, bdbVars */

/**
 * Make a request to the REST API
 *
 * @param {string} endpoint
 * @param {object} data
 * @param {string} method
 * @returns {Promise}
 */
function apiRequest(endpoint) {
  var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
  var method = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'POST';
  var options = {
    method: method,
    url: bdbVars.api_base + 'book-database/' + endpoint,
    beforeSend: function beforeSend(xhr) {
      xhr.setRequestHeader('X-WP-Nonce', bdbVars.api_nonce);
    },
    xhrFields: {
      withCredentials: true
    },
    data: data
  };
  console.log('API endpoint', endpoint);
  return new Promise(function (resolve, reject) {
    $.ajax(options).success(function (response) {
      console.log('Success response', response);
      resolve(response);
    }).error(function (qpXHR, textStatus, errorThrown) {
      var error = bdbVars.generic_erroc;

      if ('undefined' !== typeof qpXHR.responseJSON) {
        error = qpXHR.responseJSON;

        if ('undefined' !== typeof error.message) {
          error = error.message;
        }
      } else if ('undefined' !== typeof qpXHR.message) {
        error = qpXHR.message;
      }

      reject(error);
    });
  });
}
/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! jquery */ "jquery")))

/***/ }),

/***/ "./assets/js/src/utils/index.js":
/*!**************************************!*\
  !*** ./assets/js/src/utils/index.js ***!
  \**************************************/
/*! exports provided: apiRequest, spinButton, unspinButton */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _api_request_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./api-request.js */ "./assets/js/src/utils/api-request.js");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "apiRequest", function() { return _api_request_js__WEBPACK_IMPORTED_MODULE_0__["apiRequest"]; });

/* harmony import */ var _loaders_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./loaders.js */ "./assets/js/src/utils/loaders.js");
/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "spinButton", function() { return _loaders_js__WEBPACK_IMPORTED_MODULE_1__["spinButton"]; });

/* harmony reexport (safe) */ __webpack_require__.d(__webpack_exports__, "unspinButton", function() { return _loaders_js__WEBPACK_IMPORTED_MODULE_1__["unspinButton"]; });




/***/ }),

/***/ "./assets/js/src/utils/loaders.js":
/*!****************************************!*\
  !*** ./assets/js/src/utils/loaders.js ***!
  \****************************************/
/*! exports provided: spinButton, unspinButton */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "spinButton", function() { return spinButton; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "unspinButton", function() { return unspinButton; });
/* global $, bdbVars */

/**
 * Spin a button
 *
 *      - Disables the button
 *      - Saves the current button text to `data-text`
 *      - Changes the text to either a WP-Admin spinner or "Please Wait..."
 *
 * @param button
 */
function spinButton(button) {
  var newText = bdbVars.is_admin ? '<span class="spinner is-active"></span>' : bdbVars.please_wait;
  button.prop('disabled', true).data('text', button.text()).html(newText);
}
/**
 * Unspin a button
 *
 *      - Enables teh button
 *      - Sets the text to the `data-text` attribute value
 *
 * @param button
 */

function unspinButton(button) {
  button.prop('disabled', false).text(button.data('text'));
}

/***/ }),

/***/ "jquery":
/*!*************************!*\
  !*** external "jQuery" ***!
  \*************************/
/*! no static exports found */
/***/ (function(module, exports) {

module.exports = jQuery;

/***/ })

/******/ });
//# sourceMappingURL=admin.min.js.map